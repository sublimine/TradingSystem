# Historical Market Data Directory

**MANDATO 20 - MT5 Data Pipeline Institucional**

This directory contains historical market data for the SUBLIMINE Institutional Trading System.

---

## ⚠️ CRITICAL: REAL vs SYNTHETIC Data

### Data Types and Usage

| Type | Location | Naming Pattern | Purpose | Production Use |
|------|----------|----------------|---------|----------------|
| **REAL** | `data/historical/REAL/` | `REAL_{SYMBOL}_{TF}.csv` | Production calibration & trading | ✅ **YES** |
| **SYNTHETIC** | `data/historical/` | `*_SYNTHETIC.csv` | Framework testing only | ❌ **NO** |

### NON-NEGOTIABLE Rule

**Only REAL data can be used for production calibration and live trading decisions.**

Synthetic data is ONLY for:
- Testing the calibration pipeline
- Validating framework functionality
- Development and debugging

**NEVER use synthetic data for**:
- Production strategy calibration
- Live trading decisions
- Performance reporting
- Client-facing metrics

---

## Directory Structure

```
data/historical/
│
├── README.md                          # This file
│
├── REAL/                              # REAL market data (MT5, vendors)
│   ├── README.md                      # Real data documentation
│   ├── REAL_EURUSD_M15.csv           # EUR/USD 15-min (REAL)
│   ├── REAL_XAUUSD_M15.csv           # Gold 15-min (REAL)
│   ├── REAL_US500_M15.csv            # S&P 500 15-min (REAL)
│   └── ...
│
└── *_SYNTHETIC.csv                    # Synthetic data (testing only)
    ├── EURUSD.pro_M15_SYNTHETIC.csv  # EUR/USD synthetic (GBM)
    ├── XAUUSD.pro_M15_SYNTHETIC.csv  # Gold synthetic (GBM)
    └── ...
```

---

## REAL Data (Production)

### Location

`data/historical/REAL/`

### Source

- **Primary**: MetaTrader 5 (MT5) via `scripts/download_mt5_history.py`
- **Alternative**: CSV import from brokers or data vendors

### Naming Convention

```
REAL_{SYMBOL}_{TIMEFRAME}.csv
```

**Examples**:
- `REAL_EURUSD_M15.csv`
- `REAL_XAUUSD_H1.csv`
- `REAL_US500_D1.csv`

### How to Download

```bash
# Check MT5 connection
python scripts/download_mt5_history.py --check-connection

# Download data
python scripts/download_mt5_history.py \
  --symbols EURUSD,XAUUSD,US500 \
  --timeframe M15 \
  --start 2023-01-01 \
  --end 2024-12-31 \
  --dest data/historical/REAL
```

### Documentation

See: `data/historical/REAL/README.md` for detailed information.

---

## SYNTHETIC Data (Testing Only)

### Location

`data/historical/` (root level, NOT in REAL/)

### Source

- Generated by `scripts/generate_synthetic_market_data.py` (MANDATO 19)
- Uses Geometric Brownian Motion (GBM) + volatility modeling

### Naming Convention

```
{SYMBOL}*_SYNTHETIC.csv
```

**Examples**:
- `EURUSD.pro_M15_SYNTHETIC.csv`
- `XAUUSD.pro_M15_SYNTHETIC.csv`
- `US500.pro_M15_SYNTHETIC.csv`

### How to Generate

```bash
python scripts/generate_synthetic_market_data.py \
  --symbols EURUSD,XAUUSD,US500 \
  --timeframe M15 \
  --start 2023-01-01 \
  --end 2024-12-31
```

### ⚠️ Limitations

- **NOT real market data** (statistically generated)
- **NO market microstructure** (spreads, slippage, gaps)
- **NO regime changes** (smooth GBM process)
- **NO correlation structure** (symbols independent)
- **NO news events, economic releases, etc.**

**Use ONLY for**:
- Testing calibration pipeline
- Validating framework functionality
- Development without real data

---

## CSV Format

All data files (REAL and SYNTHETIC) use the same format:

```csv
timestamp,open,high,low,close,volume
2023-01-02 00:00:00+00:00,1.06720,1.06745,1.06698,1.06715,1234
2023-01-02 00:15:00+00:00,1.06715,1.06738,1.06702,1.06725,987
...
```

**Columns**:
- `timestamp`: UTC datetime (timezone-aware, ISO 8601)
- `open`: Opening price
- `high`: Highest price in bar
- `low`: Lowest price in bar
- `close`: Closing price
- `volume`: Tick volume (MT5) or actual volume

**Requirements**:
- Timestamp must be sorted (ascending)
- High >= Low
- Open, Close within [Low, High]
- Volume >= 0
- No NaN values

---

## Data Quality

### REAL Data Validation

Downloaded via `scripts/download_mt5_history.py`:

✅ **Automatic validation**:
- NaN detection and removal
- OHLC logic validation
- Outlier detection (>50% price changes)
- Completeness checking (missing bars)

See: `data/historical/REAL/README.md` for details.

### SYNTHETIC Data Validation

Generated via `scripts/generate_synthetic_market_data.py`:

✅ **Automatic generation**:
- Realistic price paths (GBM)
- Volatility clustering
- Microstructure noise
- Volume correlation

⚠️ **Still not real market data** - use only for testing.

---

## Integration with Trading System

### BacktestDataLoader

`src/backtest/backtest_data_loader.py` automatically handles both data types:

```python
# Automatically loads REAL data (preferred)
loader = BacktestDataLoader(data_dir="data/historical/REAL")
df = loader.load_symbol("EURUSD", "M15")

# Or synthetic data (testing only)
loader = BacktestDataLoader(data_dir="data/historical")
df = loader.load_symbol("EURUSD.pro", "M15")  # Finds *_SYNTHETIC.csv
```

### Strategy Calibration

**MANDATO 19 - Calibration Execution**:

```bash
# With REAL data (production)
python scripts/run_calibration_sweep.py --data-dir data/historical/REAL

# With SYNTHETIC data (testing only)
python scripts/run_calibration_sweep.py --data-dir data/historical --use-synthetic
```

---

## Timeframe Codes

| Code | Description | Bar Duration |
|------|-------------|--------------|
| M1   | 1 minute    | 1 min        |
| M5   | 5 minutes   | 5 min        |
| M15  | 15 minutes  | 15 min       |
| M30  | 30 minutes  | 30 min       |
| H1   | 1 hour      | 1 hour       |
| H4   | 4 hours     | 4 hours      |
| D1   | Daily       | 1 day        |
| W1   | Weekly      | 1 week       |
| MN1  | Monthly     | 1 month      |

**Calibration default**: M15 (15-minute bars)

---

## Data Periods (MANDATO 18R/19)

### Calibration Period

**2023-01-01 → 2024-06-30** (18 months)
- Used for strategy parameter optimization
- Walk-forward validation (3 months train, 1 month test)

### Hold-Out Period

**2024-07-01 → 2024-12-31** (6 months)
- **NEVER** used during calibration
- Only for final validation (MANDATO 18R FASE 4)

### Full Dataset

**2023-01-01 → 2024-12-31** (24 months)
- Complete dataset for institutional calibration

---

## Symbol Universe

### MANDATO 19 - Minimum Scope (3 symbols)

- **EURUSD** - EUR/USD (FX Major)
- **XAUUSD** - Gold (Commodity)
- **US500** - S&P 500 (Index)

### MANDATO 19 - Full Calibration (15 symbols)

**FX Majors (7)**:
- EURUSD, GBPUSD, USDJPY, AUDUSD, NZDUSD, USDCHF, USDCAD

**FX Crosses (2)**:
- EURJPY, GBPJPY

**Indices (3)**:
- US500 (S&P 500), NAS100 (NASDAQ 100), DE40 (DAX 40)

**Commodities (2)**:
- XAUUSD (Gold), XTIUSD (WTI Crude Oil)

**Crypto (1)**:
- BTCUSD (Bitcoin)

---

## Storage Size Estimates

### M15 Data (15-minute bars)

**24 months (2023-2024)**:
- ~35,000 bars per symbol
- ~3 MB per CSV file (uncompressed)
- **15 symbols** × 3 MB = **~45 MB total**

**5 years (extended history)**:
- ~87,500 bars per symbol
- ~7 MB per CSV file
- **15 symbols** × 7 MB = **~105 MB total**

**Conclusion**: Storage is NOT a constraint (hundreds of MB, not GB).

---

## Maintenance

### Re-downloading Data

If you need to refresh REAL data:

```bash
# Backup existing data
mv data/historical/REAL data/historical/REAL_backup_$(date +%Y%m%d)
mkdir data/historical/REAL

# Re-download
python scripts/download_mt5_history.py --symbols EURUSD,XAUUSD,US500 --timeframe M15 --start 2023-01-01 --end 2024-12-31
```

### Regenerating SYNTHETIC Data

If you need to regenerate synthetic data:

```bash
# Remove old synthetic files
rm data/historical/*_SYNTHETIC.csv

# Regenerate
python scripts/generate_synthetic_market_data.py --symbols EURUSD,XAUUSD,US500 --timeframe M15 --start 2023-01-01 --end 2024-12-31
```

---

## Troubleshooting

### No REAL Data Available

**Problem**: `data/historical/REAL/` is empty

**Solutions**:
1. Download from MT5 (preferred): See `data/historical/REAL/README.md`
2. Import CSV from broker: Place files in `data/historical/REAL/` with correct naming
3. Use SYNTHETIC data temporarily (testing only): Run `scripts/generate_synthetic_market_data.py`

### MT5 Not Available

**Problem**: `MT5 NOT AVAILABLE: MetaTrader5 module not installed`

**Solutions**:
1. Install MT5 module: `pip install MetaTrader5` (Windows only)
2. Use Windows VPS or VM
3. Import CSV from broker instead

See: `docs/RUNBOOK_MT5_DATA_ACQUISITION_*.md` for detailed setup.

### Data Quality Issues

**Problem**: Warnings about missing data, outliers, etc.

**Solution**:
1. Check validation logs: `logs/data_downloads/mt5_download_*.log`
2. Review specific issues (NaNs, outliers, gaps)
3. Re-download from broker if necessary
4. Contact broker if data quality is consistently poor

---

## Security Notes

### Data Files

- Market data is **NOT confidential** (publicly available)
- Can be committed to Git if necessary (but large files slow repo)
- Use Git LFS for large datasets if committing to repo

### Credentials

- **NEVER commit MT5 credentials** to Git
- Credentials stored in `.env` (gitignored)
- See: `config/mt5_data_config.yaml` for ENV variable structure

---

## References

**Mandatos**:
- **MANDATO 20**: Data Pipeline Institucional (this implementation)
- **MANDATO 19**: Calibration Execution (consumer of this data)
- **MANDATO 18R**: Calibration Framework (defines data requirements)
- **MANDATO 17**: Backtest Engine (data loader integration)

**Documentation**:
- `data/historical/REAL/README.md` - REAL data details
- `docs/DATA_PIPELINE_MANDATO20_*.md` - Pipeline architecture
- `docs/RUNBOOK_MT5_DATA_ACQUISITION_*.md` - VPS setup guide
- `docs/MANDATO20_STATUS_*.md` - Implementation status

**Scripts**:
- `scripts/download_mt5_history.py` - Download REAL data from MT5
- `scripts/generate_synthetic_market_data.py` - Generate SYNTHETIC test data
- `scripts/validate_market_data.py` - Validate data quality

---

**Last Updated**: 2025-11-14
**Mandato**: MANDATO 20
**Autor**: SUBLIMINE Institutional Trading System
